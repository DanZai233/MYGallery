package main

import (
	"fmt"
	"log"

	"github.com/mygallery/mygallery/internal/config"
	"github.com/mygallery/mygallery/internal/database"
	"github.com/mygallery/mygallery/internal/router"
	"github.com/mygallery/mygallery/internal/storage"
)

func main() {
	// æ‰“å°æ¬¢è¿ä¿¡æ¯
	printBanner()

	// åŠ è½½é…ç½®
	cfg, err := config.LoadConfig("config.yaml")
	if err != nil {
		log.Printf("è­¦å‘Š: æ— æ³•åŠ è½½é…ç½®æ–‡ä»¶: %v", err)
		log.Println("ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨ï¼Œè¯·åˆ›å»º config.yaml æ–‡ä»¶è¿›è¡Œé…ç½®")
		cfg = config.DefaultConfig()
	}

	// åˆå§‹åŒ–æ•°æ®åº“
	if err := database.InitDB(cfg); err != nil {
		log.Fatalf("æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: %v", err)
	}
	log.Println("âœ“ æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ")

	// åˆå§‹åŒ–å­˜å‚¨
	if err := storage.InitStorage(cfg); err != nil {
		log.Fatalf("å­˜å‚¨åˆå§‹åŒ–å¤±è´¥: %v", err)
	}
	log.Println("âœ“ å­˜å‚¨åˆå§‹åŒ–æˆåŠŸ")

	// åˆ›å»ºç®¡ç†å‘˜è´¦å·
	if err := database.CreateDefaultAdmin(cfg); err != nil {
		log.Printf("è­¦å‘Š: åˆ›å»ºç®¡ç†å‘˜è´¦å·å¤±è´¥: %v", err)
	} else {
		log.Println("âœ“ ç®¡ç†å‘˜è´¦å·å·²å°±ç»ª")
	}

	// è®¾ç½®è·¯ç”±
	r := router.SetupRouter(cfg)

	// å¯åŠ¨æœåŠ¡å™¨
	addr := fmt.Sprintf("%s:%d", cfg.Server.Host, cfg.Server.Port)
	log.Printf("\n" +
		"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n" +
		"â•‘   ğŸ¨ MYGallery v%s å¯åŠ¨æˆåŠŸ            â•‘\n" +
		"â•‘                                          â•‘\n" +
		"â•‘   ğŸ“· å‰å°é¡µé¢: http://localhost:%d       â•‘\n" +
		"â•‘   âš™ï¸  åå°ç®¡ç†: http://localhost:%d/admin â•‘\n" +
		"â•‘                                          â•‘\n" +
		"â•‘   ğŸ‘¤ ç®¡ç†å‘˜è´¦å·:                          â•‘\n" +
		"â•‘      ç”¨æˆ·å: %-20s        â•‘\n" +
		"â•‘      å¯†ç : %-20s          â•‘\n" +
		"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n",
		cfg.App.Version,
		cfg.Server.Port,
		cfg.Server.Port,
		cfg.Admin.Username,
		cfg.Admin.Password)

	if err := r.Run(addr); err != nil {
		log.Fatalf("æœåŠ¡å™¨å¯åŠ¨å¤±è´¥: %v", err)
	}
}

func printBanner() {
	banner := `
â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• 
â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â•šâ–ˆâ–ˆâ•”â•  
â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•šâ•â•     â•šâ•â•   â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•   â•šâ•â•   
                                                                                
                    ğŸ¨ ä¸ªäººç…§ç‰‡å¢™ç³»ç»Ÿ - äººäººéƒ½å¯è‡ªéƒ¨ç½² ğŸ¨                         
`
	fmt.Println(banner)
}

